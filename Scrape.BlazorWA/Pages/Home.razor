@page "/"

@using Scrape.Model
@using Scrape.Data.Helpers

@inject Data data;
@inject NavigationManager navManager

<PageTitle>Scraper</PageTitle>

<h1>Scrape VDAB website</h1>

<div>@SearchPattern.URL</div>

@foreach (var str in CheckedDomains){
    <div>@str</div>
}


<br/>

<div class="btn-group">
    <button type="button" class="btn btn-danger dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        Action
    </button>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
    @foreach (var row in data.GetDomains())
    {
            <a class="dropdown-item" @onclick="() => Check(row.Domain.Id)">                
                &nbsp;@row.Domain.Title
            </a>
    }

    </div>
</div>


@code {
    private SearchPattern SearchPattern { get; set; } = new SearchPattern();

    private IList<string> CheckedDomains { get; set; }

    protected override async Task OnInitializedAsync()
    {
        // set standard URL VDAB website search vacancies
        SearchPattern.URL = "https://www.vdab.be/vindeenjob/vacatures?sort=standaard";

        CheckedDomains = new List<string>();
    }

    public void Check(int domainId)
    {
        // loop through domains
        foreach (var row in data.GetDomains().Where(r => r.Domain.Id == domainId))
        {
            // if SearchPattern.URL has specific domain URLPattern
            if (SearchPattern.URL.Contains(row.Domain.URLPattern))
            {
                // replace that domain URLPattern with empty string
                SearchPattern.URL = SearchPattern.URL.Replace(row.Domain.URLPattern, "");

                CheckedDomains.Remove(row.Domain.Title);
            }
            else
            {
                // add pattern url
                SearchPattern.URL += row.Domain.URLPattern;
                CheckedDomains.Add(row.Domain.Title);
            }

        }
    }
}
